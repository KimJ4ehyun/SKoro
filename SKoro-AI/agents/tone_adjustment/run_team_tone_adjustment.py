import json
import re
import logging
from typing import Dict, Any, List, Optional
from langchain_openai import ChatOpenAI
from langchain.schema import HumanMessage, SystemMessage
from sqlalchemy import create_engine, text
from sqlalchemy.engine.base import Engine

from config.settings import DatabaseConfig
from agents.tone_adjustment.team_tone_adjustment import TeamLeaderToneAdjustmentAgent

logging.basicConfig(level=logging.INFO, format='[%(asctime)s] %(levelname)s: %(message)s')

# ================================================================
# 메인 실행 함수
# ================================================================

def get_db_engine() -> Engine:
    """데이터베이스 엔진 생성"""
    db_config = DatabaseConfig()
    engine = create_engine(db_config.DATABASE_URL, pool_pre_ping=True)
    return engine

def fetch_team_reports(engine: Engine, teams: list, period_id: int, report_type: str = "team_feedback_reports") -> list:
    """특정 팀들의 팀 리포트를 조회합니다."""
    placeholders = ','.join([':team_id_' + str(i) for i in range(len(teams))])
    
    # 리포트 타입에 따라 다른 컬럼 조회
    if report_type == "team_interim_evaluation":
        query = text(f"""
            SELECT DISTINCT te.team_id, te.middle_report
            FROM team_evaluations te
            WHERE te.team_id IN ({placeholders}) 
            AND te.period_id = :period_id
            AND te.middle_report IS NOT NULL  # 중간평가 리포트가 있는 팀만
            ORDER BY te.team_id;
        """)
    else:
        query = text(f"""
            SELECT DISTINCT te.team_id, te.report
            FROM team_evaluations te
            WHERE te.team_id IN ({placeholders}) 
            AND te.period_id = :period_id
            AND te.report IS NOT NULL  # 리포트가 있는 팀만
            ORDER BY te.team_id;
        """)
    
    params = {f'team_id_{i}': team_id for i, team_id in enumerate(teams)}
    params['period_id'] = period_id
    
    with engine.connect() as connection:
        results = connection.execute(query, params).fetchall()
    
    team_reports = []
    for row in results:
        team_id, report_json = row
        if report_json:
            try:
                report_data = json.loads(report_json)
                team_reports.append({
                    'team_id': team_id,
                    'report': report_data
                })
            except json.JSONDecodeError as e:
                logging.error(f"❌ 팀 {team_id} {report_type} 리포트 JSON 파싱 실패: {e}")
    
    logging.info(f"✅ 팀 {teams}의 {report_type} 리포트 {len(team_reports)}개를 처리합니다.")
    return team_reports

def save_adjusted_team_report_to_db(engine: Engine, team_id: int, adjusted_report: Dict[str, Any], period_id: int, report_type: str = "team_feedback_reports") -> bool:
    """조정된 팀 리포트를 DB에 저장합니다."""
    try:
        json_content = json.dumps(adjusted_report, ensure_ascii=False, indent=2)
        
        # 리포트 타입에 따라 다른 컬럼에 저장
        if report_type == "team_interim_evaluation":
            query = text("""
                UPDATE team_evaluations 
                SET middle_report = :report_content 
                WHERE team_id = :team_id 
                AND period_id = :period_id
            """)
        else:
            query = text("""
                UPDATE team_evaluations 
                SET report = :report_content 
                WHERE team_id = :team_id 
                AND period_id = :period_id
            """)
        
        with engine.connect() as connection:
            with connection.begin() as transaction:
                result = connection.execute(query, {
                    "report_content": json_content, 
                    "team_id": team_id, 
                    "period_id": period_id
                })
                if result.rowcount > 0:
                    transaction.commit()
                    logging.info(f"✅ 팀 {team_id}의 조정된 {report_type} 리포트가 DB에 저장되었습니다.")
                    return True
                else:
                    transaction.rollback()
                    logging.warning(f"⚠️ 팀 {team_id}에 해당하는 레코드를 찾을 수 없습니다.")
                    return False
                    
    except Exception as e:
        logging.error(f"❌ 팀 {team_id} {report_type} 리포트 저장 중 오류: {e}")
        return False

def run_team_tone_adjustment_for_team(team_id: int, team_report: Dict[str, Any], period_id: int, llm_client: ChatOpenAI, report_type: str = "team_feedback_reports") -> Dict[str, Any]:
    """특정 팀의 톤 조정을 실행합니다."""
    logging.info(f"🎨 팀 {team_id} 톤 조정 시작")
    
    try:
        agent = TeamLeaderToneAdjustmentAgent(llm_client)
        
        # 팀 리포트 타입 사용 (매개변수로 받은 값)
        
        # 톤 조정 실행
        adjusted_report = agent.process_report(team_report, report_type)
        
        # DB에 저장
        engine = get_db_engine()
        save_success = save_adjusted_team_report_to_db(engine, team_id, adjusted_report, period_id, report_type)
        
        if save_success:
            return {
                "team_id": team_id, 
                "status": "success", 
                "original_length": len(json.dumps(team_report, ensure_ascii=False)),
                "adjusted_length": len(json.dumps(adjusted_report, ensure_ascii=False))
            }
        else:
            return {"team_id": team_id, "status": "error", "message": "DB 저장 실패"}
            
    except Exception as e:
        logging.error(f"❌ 팀 {team_id} 톤 조정 중 오류: {e}")
        return {"team_id": team_id, "status": "error", "message": str(e)}

def run_team_tone_adjustment_for_teams(period_id: int, teams: list, llm_client: ChatOpenAI, report_type: str = "team_feedback_reports") -> Dict[str, Any]:
    """팀별 톤 조정을 실행합니다."""
    logging.info(f"🎨 Phase 4.2: 팀별 톤 조정 시작 - 팀 {teams}, 분기 {period_id}")
    
    engine = get_db_engine()
    
    # 대상 팀 리포트 목록 조회
    team_reports = fetch_team_reports(engine, teams, period_id, report_type)
    if not team_reports:
        logging.warning("처리할 팀 리포트가 없습니다.")
        return {"status": "no_team_reports", "results": []}
    
    # 팀별 순차 처리
    results = []
    success_count = 0
    error_count = 0
    
    for idx, team_data in enumerate(team_reports, 1):
        team_id = team_data['team_id']
        team_report = team_data['report']
        
        logging.info(f"[{idx}/{len(team_reports)}] 팀 {team_id} 처리 중...")
        
        result = run_team_tone_adjustment_for_team(team_id, team_report, period_id, llm_client, report_type)
        results.append(result)
        
        if result["status"] == "success":
            success_count += 1
        else:
            error_count += 1
    
    logging.info(f"🎉 Phase 4.2: 팀별 톤 조정 완료!")
    logging.info(f"✅ 성공: {success_count}개")
    logging.info(f"❌ 실패: {error_count}개")
    logging.info(f"📊 총 처리: {len(team_reports)}개")
    
    return {
        "status": "completed",
        "total": len(team_reports),
        "success": success_count,
        "error": error_count,
        "results": results
    }

def main(period_id: int, teams: list):
    """메인 실행 함수"""
    try:
        # LLM 클라이언트 초기화
        llm_client = ChatOpenAI(
            model="gpt-4o-mini",
            temperature=0.1
        )
        
        # 팀별 톤 조정 실행
        result = run_team_tone_adjustment_for_teams(period_id, teams, llm_client)
        
        return result
        
    except Exception as e:
        logging.error(f"❌ 팀별 톤 조정 실행 중 오류: {e}")
        return {"status": "error", "message": str(e)}

# ================================================================
# 테스트 실행 함수
# ================================================================

def test_team_leader_tone_agent():
    """팀장용 톤 조정 Agent 테스트"""
    print("🚀 팀장용 톤 조정 Agent 테스트 시작")
    
    # 환경 변수 확인
    import os
    if not os.getenv("OPENAI_API_KEY"):
        print("❌ OPENAI_API_KEY 환경변수가 설정되지 않았습니다.")
        return
    
    # 샘플 데이터 (팀 분기 레포트 - 새로운 구조)
    sample_team_feedback = {
        "기본_정보": {
            "팀명": "W1팀",
            "팀장명": "팀장A",
            "업무_수행_기간": "2024년 2분기"
        },
        "팀_종합_평가": {
            "평균_달성률": 67,
            "유사팀_평균": 85.3,
            "비교_분석": "크게 개선 필요",
            "팀_성과_분석_코멘트": "현재 팀의 성과는 전반적으로 평균적인 수준을 보이고 있으며, 팀 평균 달성률은 80.9%로 나타났습니다. 팀원 기여 분석을 통해 각 구성원의 성과를 살펴보면, AI powered ITS 혁신 부문에서 70%의 달성률을 기록하였고, 이는 비중 35%를 차지하여 팀의 주요 성과 영역 중 하나로 부각되고 있습니다. 또한, Bilable Rate(가동률)은 96%로 매우 높은 수치를 보이며, 이 역시 팀의 성과에 긍정적인 영향을 미치고 있습니다. 매출과 매출이익 부문은 각각 30%의 달성률을 기록하였으며, 이 두 영역은 비중이 각각 15%로 상대적으로 낮은 기여도를 보이고 있습니다. 이러한 성과는 팀의 현재 상태를 반영하며, 팀원 간의 협력과 개별 기여가 조화를 이루고 있음을 나타냅니다. 그러나 전체 평균 달성률이 67.1%로 나타난 점은 향후 개선이 필요한 부분으로, 팀의 지속적인 성장과 발전을 위해 각 성과 영역에서의 집중적인 노력이 요구됩니다."
        },
        "팀_업무_목표_및_달성률": {
            "kpi_목록": [
                {
                    "팀_업무_목표": "AI powered ITS 혁신",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석한 결과, 김개발과 이설계는 각각 100%의 목표 달성을 이루었으며, 박DB는 85%의 목표 달성을 기록했습니다. 전체적으로 팀 KPI의 달성률은 175%로, 목표를 초과 달성한 것으로 평가됩니다. 특히, AI 제안서 자동 생성 기능과 코딩 자동화 시스템 설계가 완벽하게 완료되어 팀의 혁신적인 성과를 이끌어냈습니다. 박DB의 데이터베이스 구축은 다소 미진하지만, 전체적인 성과에 긍정적인 영향을 미쳤습니다.",
                    "달성률": 175,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "매출",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석했을 때, 김개발님은 목표의 90%를 달성하였고, 이설계님은 목표를 초과 달성하여 82%의 성과를 보였습니다. 전체적으로 팀 KPI 목표인 인당 매출 6억에 대한 달성률은 150%로 평가됩니다. 이는 팀원들이 협력하여 성과를 극대화한 결과로, 향후에도 이러한 협업을 지속하는 것이 중요합니다.",
                    "달성률": 150,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "Bilable Rate (가동률)",
                    "kpi_분석_코멘트": "팀원 평균 가동률이 86%로 목표인 85%를 초과 달성하였으며, 이설계님은 프로젝트 지연 리스크를 17% 감소시켜 목표에 근접한 성과를 보였습니다. 전체적으로 팀 KPI는 긍정적인 방향으로 진행되고 있으며, 지속적인 모니터링과 협업이 효과를 보고 있습니다.",
                    "달성률": 102,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "매출이익",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석한 결과, 이설계님은 목표 대비 81% 달성, 박DB님은 목표 대비 60% 달성하여 전체적으로 KPI 목표의 90%를 달성하였습니다. 팀원들이 각자의 역할에서 원가 절감 및 수익성 개선을 위해 노력한 점은 긍정적이나, 목표 달성률이 100%에 미치지 못한 만큼 추가적인 개선이 필요합니다.",
                    "달성률": 90,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                }
            ],
            "전사_유사팀_비교분석_코멘트": "종합 달성률 67%는 유사팀 평균 85.3%에 비해 낮은 수준으로, 팀의 성과 개선이 필요합니다. KPI별로 살펴보면, AI powered ITS 혁신은 70%로 양호하나, Bilable Rate는 96%로 매우 높은 가동률을 보이고 있습니다. 반면, 매출과 매출이익은 각각 30%로 저조하여, 수익성 측면에서의 개선이 시급합니다. 전반적으로 팀은 혁신적인 기술 개발에는 강점을 보이나, 실질적인 매출 창출에 있어 약점을 드러내고 있습니다. 향후 매출 증대를 위한 전략적 접근이 필요하며, 고객 확보 및 시장 분석을 통해 매출 성과를 높이는 방향으로 개선할 수 있습니다."
        },
        "팀원_성과_분석": {
            "팀원별_기여도": [
                {
                    "순위": 1,
                    "이름": "김개발",
                    "달성률": 60,
                    "누적_기여도": 40,
                    "기여_내용": "김개발(SK0002)님은 현재 3개의 Task에 참여하여 평균 달성률 60.0%와 평균 기여도 40.3점을 기록하였습니다. 특히, AI 제안서 기능 고도화 개발에서 50%의 달성률을 보이며 27점의 기여도를 나타냈으나, 이는 팀 평균인 80.9%에 비해 낮은 수치입니다. 팀 가동률 모니터링 및 개선 Task에서는 75%의 달성률과 91점의 기여도를 기록하여 상대적으로 긍정적인 성과를 보였으나, 신규 고객 발굴 및 영업 지원에서는 55%의 달성률과 3점의 기여도로 낮은 기여도를 나타냈습니다. 이러한 성과를 통해 김개발님은 특정 Task에서의 강점을 보이지만, 전반적인 성과는 팀 평균에 미치지 못하는 상황입니다. 향후 성과 개선을 위해서는 각 Task의 기여도를 균형 있게 높이는 것이 필요할 것으로 보입니다."
                },
                {
                    "순위": 2,
                    "이름": "이설계",
                    "달성률": 52,
                    "누적_기여도": 35,
                    "기여_내용": "이설계(SK0003)님은 Solution Architect로서 다양한 프로젝트에 참여하여 평균 달성률 52.8%와 평균 기여도 39.5점을 기록하였습니다. 특히 AI 코딩 자동화 시스템 설계에서 96%의 높은 달성률을 보이며 41점의 기여도를 달성한 것은 주목할 만한 성과입니다. 그러나 프로젝트 효율성 관리와 개발 프로세스 최적화에서는 각각 40%와 25%의 낮은 달성률을 기록하여 개선이 필요한 부분으로 평가됩니다. 고객 관계 관리 및 만족도 향상에서는 50%의 달성률과 96점의 기여도로 긍정적인 결과를 도출하였으나, 전반적인 평균 성과는 팀 평균인 80.9%에 미치지 못하고 있습니다. 이설계님은 4개의 Task에 참여하였으며, 향후 성장 포인트로는 프로젝트 효율성 관리와 개발 프로세스 최적화 분야에서의 성과 향상이 필요합니다. 현재 역량은 특정 분야에서 두드러진 성과를 보이나, 전반적인 균형을 맞추기 위한 추가적인 노력이 요구됩니다."
                },
                {
                    "순위": 3,
                    "이름": "박DB",
                    "달성률": 27,
                    "누적_기여도": 24,
                    "기여_내용": "박DB(SK0004)님은 현재 두 개의 주요 Task에 참여하여 평균 달성률 26.5%와 평균 기여도 58.0점을 기록하였습니다. AI 시스템 데이터베이스 구축 Task에서는 30%의 달성률을 보이며 기여도 30점을 기록하였고, 시스템 성능 최적화를 통한 운영비 절감 Task에서는 23%의 달성률과 86점의 기여도를 나타냈습니다. 이러한 성과는 팀 평균 달성률 80.9%에 비해 낮은 수치로, 현재 역량 평가에서 개선이 필요한 부분이 드러납니다. 특히, 시스템 성능 최적화 Task에서의 높은 기여도는 박DB님이 해당 분야에서의 전문성을 갖추고 있음을 시사하지만, 전반적인 Task 수행에서의 낮은 달성률은 향후 성장 포인트로 작용할 수 있습니다. 따라서, 박DB님은 향후 Task 수행 시 보다 높은 목표 설정과 실행력을 통해 성과를 개선할 필요가 있습니다."
                }
            ],
            "기여도_기준": "개인별 업무 달성률과 누적 기여도를 종합하여 평가하였습니다."
        },
        "협업_네트워크": {
            "협업_매트릭스": [
                {
                    "이름": "김개발(SK0002)",
                    "총_Task_수": 3,
                    "협업률": "100.0%",
                    "핵심_협업자": [
                        "이설계(SK0003)",
                        "박DB(SK0004)"
                    ],
                    "팀_내_역할": "AI 제안서 시스템 개발 | 핵심 개발자, 팀 효율성 개선 | 기획 리더, 신규 고객 영업 | 지원 전문가",
                    "Peer_Talk_평가": "열정과 능동성, 특별한 우려사항 없음",
                    "협업_편중도": "높음(과의존 위험)",
                    "종합_평가": "김개발(SK0002)은 팀 내에서 기획 리더와 핵심 개발자로서 리더형 협업 스타일을 보이며, 팀 기여도가 높습니다. 그러나 협업 편중도가 높아 과의존 위험이 있으므로, 다양한 팀원과의 협업을 통해 균형 잡힌 협업을 강화하는 것이 필요합니다."
                },
                {
                    "이름": "이설계(SK0003)",
                    "총_Task_수": 4,
                    "협업률": "100.0%",
                    "핵심_협업자": [
                        "김개발(SK0002)",
                        "박DB(SK0004)"
                    ],
                    "팀_내_역할": "시스템 아키텍트 | 핵심 개발자",
                    "Peer_Talk_평가": "리더십 강함, 감정적 반응 주의",
                    "협업_편중도": "높음(과의존 위험)",
                    "종합_평가": "이설계(SK0003)는 리더형 협업 스타일을 보이며, 팀 내에서 높은 기여도를 나타내고 있습니다. 그러나 협업 편중도가 높아 과의존 위험이 있으므로, 다양한 팀원과의 협업을 통해 균형 잡힌 협업을 지향하는 것이 필요합니다."
                },
                {
                    "이름": "박DB(SK0004)",
                    "총_Task_수": 2,
                    "협업률": "100.0%",
                    "핵심_협업자": [
                        "김개발(SK0002)",
                        "이설계(SK0003)"
                    ],
                    "팀_내_역할": "데이터베이스 아키텍트 | 시스템 최적화 실행자",
                    "Peer_Talk_평가": "성실하고 신뢰성 있는 기술적 기여, 수동적 태도와 소통 회피",
                    "협업_편중도": "높음(과의존 위험)",
                    "종합_평가": "박DB(SK0004)는 리더형 협업 스타일을 보이며, 팀 내에서 데이터베이스 아키텍트로서 높은 기여도를 보여주고 있습니다. 그러나 협업 편중도가 높아 과의존 위험이 있으므로, 다양한 팀원과의 협업을 통해 균형 잡힌 협업을 강화하는 것이 필요합니다."
                }
            ],
            "팀_협업_요약": "팀의 전반적인 협업률이 100%로 매우 높은 수준을 유지하고 있지만, 기여도는 평균 45.9점으로 다소 낮아 보입니다. 특히 김개발(SK0002), 이설계(SK0003), 박DB(SK0004) 세 명의 팀원이 과의존 위험에 처해 있어, 이들의 역할이 팀의 성과에 지나치게 의존하고 있는 상황입니다. 이는 팀의 지속 가능성을 위협할 수 있으며, 각 팀원의 기여도를 균형 있게 높이기 위한 교육 및 역할 분담의 재조정이 필요합니다. 긍정적인 측면으로는 협업률이 높아 팀워크가 잘 이루어지고 있다는 점이 있으며, 이를 바탕으로 각 팀원의 기여도를 높이는 방향으로 개선해 나간다면 더욱 강력한 팀으로 성장할 수 있을 것입니다.",
            "협업률_설명": "개인이 수행한 전체 업무 중, 다른 팀원과 실제로 협업한 업무가 차지하는 비율입니다.",
            "협업_편중도_설명": "특정 동료에게만 협업이 쏠려있는지, 혹은 여러 동료와 고르게 협업하는지를 나타내는 지표입니다."
        },
        "팀원별_코칭_제안": {
            "일반_코칭": [
                {
                    "팀원명(사번)": "김개발(SK0002)",
                    "핵심_강점": "AI 제안서 자동 생성 모듈 개발, 기술 리더십",
                    "성장_보완점": "커뮤니케이션 스킬, 독립적인 문제 해결 능력",
                    "협업_특성": "조율자형, 팀 내 협업률 100%",
                    "성과_기여_요약": "달성률 60%, 팀 내 달성률 1위",
                    "다음_분기_코칭_제안": "다음 분기에는 사내 기술 세미나에서 AI 제안서 시스템 개발 경험을 발표하고, 주간 코드 리뷰 세션에서 피드백을 통해 커뮤니케이션 방식을 개선하도록 지원합니다."
                },
                {
                    "팀원명(사번)": "이설계(SK0003)",
                    "핵심_강점": "AI 코딩 자동화 아키텍처 설계, 기술 문제 해결 능력",
                    "성장_보완점": "감정 조절 능력, 비판적 사고 및 타협 능력",
                    "협업_특성": "조율자형, 감정적 반응으로 인한 협업 저해",
                    "성과_기여_요약": "달성률 52.75%, 팀 내 달성률 2위",
                    "다음_분기_코칭_제안": "다음 분기에는 감정 조절 및 협상 기술 교육에 참여하고, 정기적인 피드백 세션을 통해 협업 태도를 점검하도록 합니다."
                },
                {
                    "팀원명(사번)": "박DB(SK0004)",
                    "핵심_강점": "데이터 아키텍처 설계, 데이터 처리 효율성",
                    "성장_보완점": "소통 능력, 주도적 태도",
                    "협업_특성": "수동적, 의견 충돌 회피",
                    "성과_기여_요약": "달성률 26.5%, 팀 내 달성률 3위",
                    "다음_분기_코칭_제안": "다음 분기에는 소통 및 협업 기술 향상을 위한 워크숍에 참여하고, 정기적인 피드백 세션을 통해 태도 개선을 모니터링할 계획입니다."
                }
            ],
            "집중_코칭": [
                {
                    "팀원명(사번)": "이설계(SK0003)",
                    "핵심_이슈": "해당 직원은 People 점수가 3.0으로 낮고, 감정적이고 방어적인 태도로 인해 협업 과정에서 비판적이고 타협이 부족한 모습을 보였습니다.",
                    "상세_분석": "감정 조절 및 타협 능력 부족이 협업에 부정적인 영향을 미치고 있으며, 이는 팀 내 협업 효율성을 저하시킬 수 있습니다.",
                    "리스크_요소": "감정적 반응으로 인한 협업 저해, 팀 내 갈등 가능성, 비판적 태도로 인한 동료와의 관계 악화",
                    "코칭_제안": "1. 감정 조절 훈련: 감정 인식 및 조절 기법 교육. 2. 협업 기술 향상: 타협 및 소통 기술 훈련. 3. 정기적인 피드백 세션: 동료와의 피드백을 통해 협업 태도 점검 및 개선."
                },
                {
                    "팀원명(사번)": "박DB(SK0004)",
                    "핵심_이슈": "해당 직원은 People 점수가 3.0으로 낮고, Peer Talk에서 수동적인 태도와 소통 단절 경향이 우려됨.",
                    "상세_분석": "직원의 수동적인 태도와 의견 충돌 회피로 인해 소통이 원활하지 않으며, 이는 협업에 부정적인 영향을 미칠 수 있음.",
                    "리스크_요소": "1) 수동적인 태도로 인한 협업 저해 2) 소통 단절로 인한 팀 내 신뢰도 저하",
                    "코칭_제안": "1) 소통 및 협업 기술 향상을 위한 워크숍 참여 2) 정기적인 피드백 세션을 통해 태도 개선 모니터링 3) 적극적인 의견 개진을 유도하기 위한 멘토링 제공"
                }
            ]
        },
        "리스크_및_향후_운영_제안": {
            "주요_리스크": [
                {
                    "주요리스크": "과의존 위험",
                    "리스크_심각도": "high",
                    "리스크_설명": "팀원들이 특정 인원(김개발, 이설계, 박DB)에게 과도하게 의존하고 있어, 이들의 부재 시 팀의 성과에 심각한 영향을 미칠 수 있습니다.",
                    "발생_원인": [
                        "김개발(SK0002), 이설계(SK0003), 박DB(SK0004) 모두 서로를 주요 협업자로 지목하고 있으며, 이들의 협업 편중도가 높음.",
                        "팀의 평균 기여도가 45.9점으로 낮아, 특정 인원에게 의존하는 경향이 반영됨."
                    ],
                    "영향_예측": [
                        {
                            "영향_범위": "team",
                            "발생_시점": "immediate",
                            "영향_설명": "특정 팀원이 부재할 경우, 팀의 성과가 급격히 저하될 수 있으며, 이는 프로젝트의 지연 및 품질 저하로 이어질 수 있음."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        {
                            "전략_설명": "팀원 간의 협업을 다양화하고, 각 팀원의 역할과 책임을 명확히 하여 특정 인원에 대한 의존도를 줄이는 교육 및 워크숍을 실시."
                        }
                    ]
                },
                {
                    "주요리스크": "매출 및 매출이익 저조",
                    "리스크_심각도": "high",
                    "리스크_설명": "매출과 매출이익 KPI의 달성률이 각각 30%로 매우 낮아, 팀의 재무적 성과에 심각한 리스크가 존재합니다.",
                    "발생_원인": [
                        "매출 KPI의 달성률이 30%로 목표에 미치지 못함.",
                        "매출이익 KPI의 달성률이 30%로 목표에 미치지 못함."
                    ],
                    "영향_예측": [
                        {
                            "영향_범위": "organization",
                            "발생_시점": "long_term",
                            "영향_설명": "재무적 성과 저조로 인해 팀의 지속적인 운영과 성장에 부정적인 영향을 미치며, 인력 감축 및 프로젝트 축소로 이어질 수 있음."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        {
                            "전략_설명": "매출 증대를 위한 새로운 마케팅 전략을 수립하고, 고객 피드백을 반영하여 제품 및 서비스 개선에 집중."
                        }
                    ]
                },
                {
                    "주요리스크": "AI powered ITS 혁신 성과 부족",
                    "리스크_심각도": "medium",
                    "리스크_설명": "AI powered ITS 혁신 KPI의 달성률이 70%로, 목표 달성을 위해 추가적인 노력이 필요합니다.",
                    "발생_원인": [
                        "AI powered ITS 혁신 KPI의 달성률이 70%로 목표에 미치지 못함.",
                        "팀원들이 협업을 통해 주요 작업을 진행하고 있으나, 전체 목표 달성을 위해서는 추가적인 노력이 필요함."
                    ],
                    "영향_예측": [
                        {
                            "영향_범위": "team",
                            "발생_시점": "short_term",
                            "영향_설명": "혁신 성과 부족으로 인해 팀의 신뢰도가 저하되고, 향후 프로젝트 수주에 부정적인 영향을 미칠 수 있음."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        {
                            "전략_설명": "AI powered ITS 관련 교육 및 워크숍을 통해 팀원들의 역량을 강화하고, 혁신 아이디어를 발굴하기 위한 브레인스토밍 세션을 정기적으로 개최."
                        }
                    ]
                },
                {
                    "주요리스크": "소통 회피 및 수동적 태도",
                    "리스크_심각도": "medium",
                    "리스크_설명": "박DB(SK0004)는 수동적 태도와 소통 회피가 관찰되며, 이는 팀 내에서의 정보 공유와 협업에 부정적인 영향을 미칠 수 있습니다.",
                    "발생_원인": [
                        "박DB(SK0004)의 peer_talk_summary에서 '수동적 태도와 소통 회피'가 언급됨.",
                        "팀의 기여도가 낮은 상황에서 박DB의 소통 회피는 더욱 심각한 문제로 작용할 수 있음."
                    ],
                    "영향_예측": [
                        {
                            "영향_범위": "team",
                            "발생_시점": "immediate",
                            "영향_설명": "소통 회피로 인해 팀 내 정보 공유가 원활하지 않아, 프로젝트 진행에 차질이 생길 수 있음."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        {
                            "전략_설명": "정기적인 팀 미팅을 통해 소통을 장려하고, 박DB가 의견을 자유롭게 표현할 수 있는 환경을 조성."
                        }
                    ]
                },
                {
                    "주요리스크": "가동률 개선 필요",
                    "리스크_심각도": "medium",
                    "리스크_설명": "가동률 KPI의 달성률이 96%로 높지만, 팀원 개별 가동률이 평균 82%로 목표에 미치지 못하고 있어, 팀의 효율성에 대한 리스크가 존재합니다.",
                    "발생_원인": [
                        "팀원들의 평균 가동률이 82%로 목표인 85%에 미치지 못함.",
                        "이설계님은 프로젝트 리스크 감소에 집중하여 가동률에 직접적인 영향을 미치지 않음."
                    ],
                    "영향_예측": [
                        {
                            "영향_범위": "team",
                            "발생_시점": "short_term",
                            "영향_설명": "가동률 저조로 인해 팀의 전체적인 생산성이 감소하고, 프로젝트 일정에 차질이 생길 수 있음."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        {
                            "전략_설명": "팀원 개별의 업무 분담을 재조정하고, 가동률을 높이기 위한 목표 설정 및 모니터링 체계를 강화."
                        }
                    ]
                }
            ]
        },
        "총평": {
            "주요_인사이트": "**[팀 성과 방향]**  \nW1팀은 연간 평균 달성률 67%로, KPI 4개 중 2개에서 30%의 낮은 성과를 기록하며 상대적으로 개선이 필요함을 보여주었습니다. 특히, 매출과 매출이익 KPI의 성과가 각각 30%에 그쳐, 전년 대비 성장률이 없다는 점은 팀의 전략적 방향성을 재조정할 필요성을 시사합니다. AI powered ITS 혁신은 70%의 진척도를 보였으나, 전체 성과에 비해 상대적으로 낮은 기여도를 나타내고 있어, 성과 창출 능력에 대한 재검토가 필요합니다.\n\n**[구조적 인식]**  \nW1팀의 강점은 높은 가동률(96%)을 유지하고 있다는 점으로, 이는 팀원들이 효율적으로 자원을 활용하고 있음을 나타냅니다. 그러나, 과의존 위험과 소통 회피 및 수동적 태도는 팀의 구조적 도전과제로 작용하고 있으며, 이는 팀의 혁신성과 성과에 부정적인 영향을 미치고 있습니다. 지속 가능한 성장을 위해서는 이러한 리스크를 관리하고, 팀원 간의 소통을 활성화하는 것이 핵심 요소로 부각됩니다.\n\n**[향후 운영 전략]**  \n차년도 계획은 아직 구체화되지 않았으나, W1팀은 매출 및 매출이익 개선을 위한 전략적 우선순위를 설정해야 합니다. 이를 위해, 매출 목표를 50%로 설정하고, AI powered ITS 혁신의 성과를 90%로 끌어올리는 것을 목표로 삼아야 합니다. 또한, 팀원 간의 소통을 강화하기 위한 정기적인 회의와 피드백 세션을 도입하여, 수동적 태도를 극복하고 적극적인 참여를 유도하는 실행 방안을 마련해야 합니다."
        }
    }

    sample_mid_feedback = {
        "리포트_유형": "연말 중간평가 리포트 (Period 4)",
        "기본_정보": {
            "팀명": "W1팀",
            "팀장명": "팀장A",
            "업무 수행 기간": "2024년 연말"
        },
        "팀원_평가_요약표": {
            "표": [
                {
                    "이름": "김개발(SK0002)",
                    "AI 추천 점수": 3.72,
                    "총 Task 수": 3,
                    "협업률": "100.0%",
                    "핵심 협업자": [
                        "이설계(SK0003)",
                        "박DB(SK0004)"
                    ],
                    "팀 내 역할": "AI 제안서 시스템 개발 | 핵심 개발자, 팀 가동률 관리 | 조율자, 신규 고객 발굴 | 기획 리더",
                    "Peer Talk 평가": "AI 제안서 자동 생성 완성, 부정적 피드백 없음",
                    "협업 편중도": "높음(과의존 위험)%",
                    "종합 평가": "김개발(SK0002)은 팀 내에서 리더형 협업 스타일을 보이며, AI 제안서 시스템 개발과 신규 고객 발굴에 있어 높은 기여도를 나타내고 있습니다. 그러나 협업 편중도가 높아 과의존 위험이 있으므로, 다양한 팀원과의 협업을 통해 균형 잡힌 협업을 강화하는 것이 필요합니다."
                },
                {
                    "이름": "이설계(SK0003)",
                    "AI 추천 점수": 3.62,
                    "총 Task 수": 4,
                    "협업률": "100.0%",
                    "핵심 협업자": [
                        "김개발(SK0002)",
                        "박DB(SK0004)"
                    ],
                    "팀 내 역할": "AI 코딩 자동화 시스템 아키텍처 설계 | 기획 리더, 프로젝트 관리 체계 구축 | 기획 리더, 고객 만족도 관리 | 기획 리더, 개발 원가 관리 | 기획 리더",
                    "Peer Talk 평가": "AI 아키텍처 설계 능력, 비판적 피드백 수용 어려움",
                    "협업 편중도": "높음(과의존 위험)%",
                    "종합 평가": "이설계(SK0003)는 기획 리더로서 팀 내에서 높은 협업률을 보이며, 프로젝트 관리와 고객 만족도 관리에 기여하고 있습니다. 그러나 협업 편중도가 높아 김개발(SK0002)과 박DB(SK0004)에 과의존하는 경향이 있어, 독립적인 문제 해결 능력을 강화하는 것이 필요합니다. 팀 기여도는 높으나, 다양한 협업자와의 균형 잡힌 협업을 통해 더욱 발전할 수 있을 것입니다."
                },
                {
                    "이름": "박DB(SK0004)",
                    "AI 추천 점수": 3.02,
                    "총 Task 수": 2,
                    "협업률": "100.0%",
                    "핵심 협업자": [
                        "김개발(SK0002)",
                        "이설계(SK0003)"
                    ],
                    "팀 내 역할": "AI 데이터베이스 시스템 관리 | 운영비 최적화",
                    "Peer Talk 평가": "책임감과 성실함, 소통 개선 필요",
                    "협업 편중도": "높음(과의존 위험)%",
                    "종합 평가": "박DB(SK0004) 직원은 리더형 협업 스타일을 보이며, 팀 내에서 높은 기여도를 나타내고 있습니다. 그러나 협업 편중도가 높아 과의존 위험이 있으므로, 다양한 팀원과의 협업을 통해 균형 잡힌 협업 네트워크를 구축하는 것이 필요합니다."
                }
            ],
            "팀_협업_요약": "팀의 전반적인 협업 현황은 매우 긍정적이며, 전체 평균 협업률이 100%에 달하는 것은 팀원 간의 원활한 소통과 협력이 이루어지고 있음을 나타냅니다. 그러나 기여도가 평균 43.3점으로 다소 낮고, 특히 김개발, 이설계, 박DB 세 명의 팀원이 과의존 위험에 처해 있는 점은 우려스러운 부분입니다. 이들은 팀의 핵심 역할을 맡고 있지만, 지나치게 의존하는 경향이 있어 장기적으로 팀의 지속 가능성과 다양성을 저해할 수 있습니다. 따라서, 이들의 역할을 분산시키고 다른 팀원들의 참여를 유도하는 방안을 모색하는 것이 필요하며, 이를 통해 팀의 전반적인 기여도를 높이고 협업의 균형을 맞출 수 있을 것입니다.",
            "협업률_설명": "개인이 수행한 전체 업무 중, 다른 팀원과 실제로 협업한 업무가 차지하는 비율입니다.",
            "협업_편중도_설명": "특정 동료에게만 협업이 쏠려있는지, 혹은 여러 동료와 고르게 협업하는지를 나타내는 지표입니다."
        },
        "팀원별_평가_근거": [
            {
                "기본_내용": {
                    "이름": "김개발",
                    "직무": "Backend Engineer",
                    "CL레벨": "CL3"
                },
                "AI_점수_산출_기준": {
                    "업적": {
                        "점수": 3.2,
                        "실적 요약": "김개발(SK0002)님은 올해 총 3개의 주요 Task에 참여하여 평균 달성률 95.0%를 기록하며 팀의 성과에 기여하였습니다. 특히, AI 제안서 기능 고도화 개발과 팀 가동률 모니터링 및 개선 Task에서 각각 100%의 달성률을 보이며, 기여도는 35점과 83점으로 팀 내에서 중요한 역할을 수행하였습니다. 신규 고객 발굴 및 영업 지원 Task에서는 85%의 달성률을 기록하였으나, 기여도는 10점으로 상대적으로 낮은 편이었습니다. 이러한 성과를 바탕으로 팀 평균 달성률 104.8%를 초과 달성하는 데 기여하였으며, 김개발님은 팀의 핵심 기여 영역에서 두드러진 성과를 보였습니다. 종합역량평가에서 김개발님은 팀의 목표 달성에 있어 중요한 역할을 하였으며, 향후에도 지속적인 성과 향상을 기대할 수 있는 기반을 마련하였습니다."
                    },
                    "SK_Values": {
                        "Passive": {
                            "점수": 4.5,
                            "평가 근거": "김개발은 다양한 프로젝트에서 주도적으로 역할을 수행하며, 목표를 초과 달성하는 성과를 지속적으로 보여주었습니다. 특히, AI 제안서 시스템 개발과 팀 가동률 향상에 기여하며, 협업을 통해 긍정적인 결과를 도출했습니다. 이러한 성과는 그의 높은 주인의식과 열정적인 업무 태도를 반영합니다."
                        },
                        "Proactive": {
                            "점수": 4.5,
                            "평가 근거": "김개발은 팀의 생산성 향상과 신규 고객 확보를 위해 능동적으로 문제를 분석하고 해결책을 제시했습니다. 특히, AI 제안서 자동 생성 시스템 개발과 가동률 개선을 통해 팀의 효율성을 크게 향상시켰으며, 고객 발굴 체계를 정착시켜 영업 성과를 높였습니다. 이러한 성과는 김개발이 주도적으로 혁신적인 아이디어를 실행하고, 팀의 변화를 이끌어낸 결과입니다."
                        },
                        "Professional": {
                            "점수": 4.5,
                            "평가 근거": "김개발은 AI 제안서 자동 생성 시스템의 핵심 개발자로서 요구사항 분석과 알고리즘 설계에 기여하며, 팀의 생산성 향상에 중요한 역할을 했습니다. 또한, 팀 가동률을 효과적으로 분석하고 개선하여 목표를 초과 달성하였으며, 신규 고객 발굴 및 계약 체결에서도 뛰어난 성과를 보였습니다. 이러한 성과들은 그의 전문성이 높고, 팀 내에서 기술과 지식을 효과적으로 전파하고 있다는 것을 보여줍니다."
                        },
                        "People": {
                            "점수": 4.5,
                            "평가 근거": "김개발은 팀워크를 극대화하고, 동료들과의 협업을 통해 팀의 목표 달성에 크게 기여했습니다. 특히, 다양한 프로젝트에서 주도적인 역할을 수행하며 팀의 결속력을 강화하고, 긍정적인 소통을 통해 팀 분위기를 이끌어갔습니다. 그러나 협업 편중도가 높아 다양한 팀원과의 협업을 통해 균형 잡힌 협업을 지향할 필요가 있습니다."
                        }
                    },
                    "종합 원점수": 3.72,
                    "AI 추천 점수 (CL 정규화)": 3.72,
                    "평가 근거 요약": "김개발(SK0002)님은 올해 총 3개의 주요 Task에 참여하여 평균 달성률 95.0%를 기록하며 팀의 성과에 기여하였습니다. 달성률 점수는 3.2점으로 B등급에 해당하며, 목표에 근접한 성과를 보였습니다. 특히, AI 제안서 기능 고도화 개발과 팀 가동률 모니터링 및 개선 Task에서 각각 100%의 달성률을 기록하여 팀 내에서 중요한 역할을 수행하였습니다. 4P 평가에서 Passionate, Proactive, Professional, People 모두 4.5점을 기록하여, 총 평균 4.5점으로 매우 우수한 성과를 나타냈습니다. 최종 정규화 점수는 3.72점으로, 팀 내 CL3 기준에 따라 원시 점수를 유지하였습니다. 이러한 성과는 팀 평균 달성률 104.8%를 초과 달성하는 데 기여하였으며, 향후 지속적인 성과 향상을 기대할 수 있는 기반을 마련하였습니다."
                },
                "연간_핵심_성과_기여도": {
                    "Task_표": [
                        {
                            "Task명": "AI 제안서 기능 고도화 개발",
                            "핵심 Task": "AI 제안서 자동 생성 기능 100% 완성. 실제 업무에 적용하여 제안서 작성 시간 42% 단축. 이설계님과 운영 가이드, 박DB님과 데이터 관리 협업 완료.",
                            "누적 달성률 (%)": 100,
                            "분석 코멘트": "2023년 동안 팀은 평균 104.8%의 성과 달성률을 기록하며, 각 구성원이 중요한 기여를 하였습니다. 특히 김개발(SK0002)님은 AI 제안서 자동 생성 기능을 100% 완성하여, 실제 업무에 적용함으로써 제안서 작성 시간을 42% 단축하는 성과를 이루었습니다. 이설계님과의 운영 가이드 협업, 박DB님과의 데이터 관리 협업을 통해 팀의 시너지를 극대화하였으며, 이러한 협력은 팀 전체의 성장에 긍정적인 영향을 미쳤습니다. 김개발님은 35점의 기여도를 기록하며 팀의 목표 달성에 중대한 역할을 하였고, 이는 팀의 연간 성과와 성장 추이를 더욱 견고히 하는 데 기여하였습니다. 전체적으로, 팀은 각자의 역할을 충실히 수행하며, 지속적인 성장을 이루어낸 한 해였습니다."
                        },
                        {
                            "Task명": "팀 가동률 모니터링 및 개선",
                            "핵심 Task": "팀 평균 가동률 86% 목표 초과 달성. 지속적인 모니터링 및 개선 체계 완전 구축. 이설계님과 유지 전략, 박DB님과 모니터링 시스템 협업 완료.",
                            "누적 달성률 (%)": 100,
                            "분석 코멘트": "2023년 동안 팀은 평균 104.8%의 성과 달성률을 기록하며, 지속적인 성장 추이를 보였습니다. 특히, 김개발(SK0002)님은 팀 평균 가동률 목표인 85%를 초과 달성하여 86%를 기록하였으며, 이는 팀의 전반적인 성과에 긍정적인 영향을 미쳤습니다. 김개발님은 이설계님과의 유지 전략 및 박DB님과의 모니터링 시스템 협업을 통해 지속적인 모니터링 및 개선 체계를 완전히 구축하였고, 이러한 기여는 팀의 목표 달성에 중요한 역할을 하였습니다. 종합적으로 볼 때, 김개발님은 100%의 달성률과 83점의 기여도로 팀의 성과에 크게 기여하였으며, 이는 팀의 성장과 발전에 기여한 바가 큽니다."
                        },
                        {
                            "Task명": "신규 고객 발굴 및 영업 지원",
                            "핵심 Task": "신규 계약 총 1.8건 체결 완료(총 6.5억원 규모). 신규 고객 발굴 체계 정착. 이설계님과 추천 시스템, 박DB님과 성과 분석 협업 완료.",
                            "누적 달성률 (%)": 85,
                            "분석 코멘트": "2023년 동안 김개발(SK0002)님은 신규 고객 발굴 및 영업 지원 분야에서 총 1.8건의 신규 계약을 체결하며 6.5억원 규모의 성과를 달성했습니다. 이는 팀 평균 달성률 104.8%에 비해 85%의 달성률을 기록한 것으로, 목표에 근접한 성과를 보여줍니다. 특히, 이설계님과의 추천 시스템 구축 및 박DB님과의 성과 분석 협업을 통해 신규 고객 발굴 체계를 정착시키는 데 기여하였습니다. 이러한 팀 내 협업은 김개발님이 팀의 성장에 긍정적인 영향을 미쳤음을 나타내며, 종합적으로 평가할 때 그의 기여도는 10점으로 평가됩니다. 전체적으로, 김개발님은 연간 성과에서 중요한 역할을 수행하며 팀의 성장 추이에 기여한 바가 큽니다."
                        }
                    ],
                    "개인 종합 달성률": 76,
                    "종합 기여 코멘트": "김개발(SK0002)님은 올해 총 3개의 Task에 참여하여 평균 달성률 76.7%와 평균 기여도 44.0점을 기록하였습니다. 특히, AI 제안서 기능 고도화 개발에서 85%의 달성률을 보이며 33점의 기여도를 나타냈고, 팀 가동률 모니터링 및 개선 Task에서는 95%의 높은 달성률과 85점의 기여도로 팀에 중요한 기여를 하였습니다. 반면, 신규 고객 발굴 및 영업 지원 Task에서는 50%의 달성률과 14점의 기여도로 상대적으로 낮은 성과를 보였습니다. 이러한 성과를 통해 김개발님은 팀 평균 달성률 92.0%에 비해 다소 낮은 성과를 기록하였으나, 가동률 개선에 대한 기여는 두드러진 점으로 평가됩니다. 현재 역량은 특정 Task에서의 높은 성과와 낮은 성과가 혼재되어 있으며, 향후 성장 포인트로는 신규 고객 발굴 및 영업 지원 분야에서의 개선이 필요할 것으로 보입니다."
                },
                "Peer_Talk": {
                    "강점": "해당 직원은 AI 제안서 자동 생성 기능의 85% 완성을 주도하며, 열정적이고 주도적인 자세로 프로젝트를 이끌었습니다. 능동적으로 통합 테스트와 성능 최적화를 진행하여 프로젝트의 완성도를 높이는 데 기여했습니다.",
                    "우려": "현재 분석된 데이터에서는 특별한 우려사항이 발견되지 않았습니다.",
                    "협업 관찰": "해당 직원은 이설계님과의 성능 튜닝 및 박DB님과의 DB 최적화 협업을 통해 문제해결력을 발휘하였으며, 신뢰할 수 있는 열린 소통으로 팀워크를 향상시켰습니다."
                }
            },
            {
                "기본_내용": {
                    "이름": "이설계",
                    "직무": "Solution Architect",
                    "CL레벨": "CL3"
                },
                "AI_점수_산출_기준": {
                    "업적": {
                        "점수": 3.2,
                        "실적 요약": "이설계(SK0003)님은 2023년 동안 총 4개의 주요 Task에 참여하여 평균 달성률 94.2%와 평균 기여도 46.8점을 기록하였습니다. 특히 AI 코딩 자동화 시스템 설계에서 120%의 높은 달성률을 보이며 35점의 기여도를 기록, 팀의 핵심 기여 영역으로 자리매김하였습니다. 반면, 프로젝트 효율성 관리와 개발 프로세스 최적화를 통한 원가 절감에서는 각각 85%와 82%의 달성률을 기록하며 기여도가 다소 낮은 편이었으나, 고객 관계 관리 및 만족도 향상에서는 90%의 달성률과 89점의 기여도로 긍정적인 성과를 나타냈습니다. 이러한 성과는 팀 평균 달성률 104.8%에 기여하며, 이설계님은 팀 내에서 중요한 역할을 수행하고 있음을 보여줍니다. 종합적으로 볼 때, 이설계님은 다양한 Task에서 고른 성과를 내며 팀의 목표 달성에 기여하고 있으며, 향후에도 지속적인 성장을 기대할 수 있는 역량을 갖추고 있습니다."
                    },
                    "SK_Values": {
                        "Passive": {
                            "점수": 4.5,
                            "평가 근거": "이설계는 다양한 프로젝트에서 주인의식을 가지고 적극적으로 업무를 추진하며, 팀원들과의 협업을 통해 뛰어난 성과를 달성했습니다. 특히, 리스크 관리와 고객 만족도 개선에서의 성과는 그의 열정과 헌신을 잘 보여줍니다. 또한, 반복적인 업무를 자동화하여 효율성을 높이는 데 기여한 점도 긍정적입니다."
                        },
                        "Proactive": {
                            "점수": 4.5,
                            "평가 근거": "이설계는 반복적인 문제를 능동적으로 해결하기 위해 AI 코딩 자동화 시스템을 도입하고, 리스크 관리 및 고객 만족도 개선을 위한 체계적인 접근을 통해 조직의 효율성을 높이는 데 기여했습니다. 이러한 성과는 단순한 문제 해결을 넘어, 미래의 비즈니스 기회를 창출하고 조직의 방향성을 제시하는 데 중요한 역할을 했습니다."
                        },
                        "Professional": {
                            "점수": 4.5,
                            "평가 근거": "이설계는 다양한 프로젝트에서 리더십을 발휘하며, 기술적 전문성을 바탕으로 팀의 생산성과 고객 만족도를 크게 향상시켰습니다. 특히, AI 코딩 자동화 시스템과 리스크 관리 시스템 구축에서 보여준 성과는 그의 전문성을 잘 나타냅니다. 또한, 동료들과의 협업을 통해 복잡한 문제를 효과적으로 해결하고, 팀의 전반적인 전문성 향상에 기여했습니다."
                        },
                        "People": {
                            "점수": 3.5,
                            "평가 근거": "이설계는 팀 프로젝트에 적극적으로 참여하고, 동료들과의 협업을 통해 팀 목표 달성에 기여하고 있습니다. 그러나 감정적이고 방어적인 태도로 인해 팀원들과의 원활한 소통에 어려움을 겪고 있으며, 이는 팀워크에 부정적인 영향을 미칠 수 있습니다. 따라서 원활한 소통과 상호 존중을 기반으로 한 협업이 필요합니다."
                        }
                    },
                    "종합 원점수": 3.62,
                    "AI 추천 점수 (CL 정규화)": 3.62,
                    "평가 근거 요약": "이설계(SK0003)님은 2023년 동안 총 4개의 주요 Task에 참여하여 평균 달성률 94.2%를 기록하였으며, 이는 B등급에 해당하는 목표 근접 성과입니다. 특히 AI 코딩 자동화 시스템 설계에서 120%의 높은 달성률을 보이며 35점의 기여도를 기록하였습니다. 반면, 프로젝트 효율성 관리와 개발 프로세스 최적화를 통한 원가 절감에서는 각각 85%와 82%의 달성률을 기록하였으나, 고객 관계 관리 및 만족도 향상에서는 90%의 달성률과 89점의 기여도로 긍정적인 성과를 나타냈습니다. 4P 평가 결과에서 Passionate, Proactive, Professional 모두 4.5점을 기록하였고, People 항목에서 3.5점을 기록하여 팀 내 협업에서의 개선이 필요함을 시사합니다. 최종 정규화 점수는 3.62점으로, 팀 내 CL3 기준으로 유지되었습니다. 종합적으로 이설계님은 다양한 Task에서 고른 성과를 내며 팀의 목표 달성에 기여하고 있으며, 향후에도 지속적인 성장을 기대할 수 있는 역량을 갖추고 있습니다."
                },
                "연간_핵심_성과_기여도": {
                    "Task_표": [
                        {
                            "Task명": "AI 코딩 자동화 시스템 설계",
                            "핵심 Task": "AI 코딩 자동화 시스템 아키텍처 설계 100% 완료. 구현 가이드 및 개발 표준 수립. 김개발님과 표준 가이드, 박DB님과 데이터 정책 협업 완료.",
                            "누적 달성률 (%)": 120,
                            "분석 코멘트": "2023년 동안 팀은 연간 목표 달성률 104.8%를 기록하며 안정적인 성장을 이어갔습니다. 특히, 이설계(SK0003)님은 AI 코딩 자동화 시스템 아키텍처 설계를 100% 완료하고, 구현 가이드 및 개발 표준을 수립하여 팀의 성과에 크게 기여하였습니다. 이설계님은 김개발님과의 협업을 통해 표준 가이드를, 박DB님과는 데이터 정책을 성공적으로 정립하며 팀의 전반적인 기여도를 높였습니다. 이러한 성과는 팀의 평균 기여도 35점을 반영하며, 각 구성원이 협력하여 이룬 결과임을 보여줍니다. 전반적으로, 팀은 지속적인 성장 추이를 보이며, 각자의 역할을 충실히 수행한 결과로 종합 평가에서 긍정적인 성과를 달성하였습니다."
                        },
                        {
                            "Task명": "프로젝트 효율성 관리",
                            "핵심 Task": "프로젝트 지연 리스크 17% 감소 목표 달성. 효율적인 프로젝트 관리 체계 정착. 김개발님과 통합 관리, 박DB님과 모니터링 협업 완료.",
                            "누적 달성률 (%)": 85,
                            "분석 코멘트": "2023년 동안 팀은 평균 104.8%의 성과 달성률을 기록하며, 각 구성원이 프로젝트 효율성 관리에 기여한 바가 큽니다. 이설계(SK0003)님은 프로젝트 지연 리스크를 20% 감소시키는 목표를 설정하고, 실제로 17% 감소를 달성하여 목표에 근접한 성과를 보였습니다. 이 과정에서 김개발님과의 통합 관리 및 박DB님과의 모니터링 협업을 통해 효율적인 프로젝트 관리 체계를 정착시켰습니다. 이설계님은 16점의 기여도를 기록하며 팀의 성장에 중요한 역할을 하였고, 이러한 성과는 팀 전체의 성장 추이에 긍정적인 영향을 미쳤습니다. 종합적으로, 팀의 성과는 각 구성원의 협업과 노력 덕분에 더욱 강화되었으며, 향후에도 이러한 성과를 지속적으로 이어갈 수 있는 기반이 마련되었습니다."
                        },
                        {
                            "Task명": "고객 관계 관리 및 만족도 향상",
                            "핵심 Task": "고객 만족도 8.2% 향상 목표 달성. 고객 관계 관리 체계 완전 정착. 김개발님과 자동화 시스템, 박DB님과 예측 모델 협업 완료.",
                            "누적 달성률 (%)": 90,
                            "분석 코멘트": "2023년 동안 이설계(SK0003)님은 고객 관계 관리 및 만족도 향상 목표를 설정하고, 고객 만족도를 10% 향상시키기 위해 노력하였습니다. 그 결과, 고객 만족도는 8.2% 향상되어 목표 달성률 90%를 기록하였으며, 이는 팀 평균 달성률 104.8%에 비해 다소 낮은 수치입니다. 이설계님은 김개발님과의 자동화 시스템 구축 및 박DB님과의 예측 모델 협업을 통해 고객 관계 관리 체계를 완전히 정착시키는 데 기여하였습니다. 이러한 팀원 간의 협업은 팀 전체의 성장 추이에 긍정적인 영향을 미쳤으며, 이설계님은 89점의 기여도를 기록하여 팀의 성과에 중요한 역할을 하였습니다. 종합적으로, 이설계님은 연간 성과에서 의미 있는 진전을 이루었으나, 향후 목표 달성을 위해 추가적인 노력이 필요할 것으로 보입니다."
                        },
                        {
                            "Task명": "개발 프로세스 최적화를 통한 원가 절감",
                            "핵심 Task": "개발 원가 8.1% 절감 목표 달성. 효율적인 개발 프로세스 완전 정착. 김개발님과 AI 지원 체계, 박DB님과 모니터링 시스템 협업 완료.",
                            "누적 달성률 (%)": 82,
                            "분석 코멘트": "2023년 동안 팀은 연간 목표 달성률 104.8%를 기록하며 긍정적인 성장 추이를 보였습니다. 이설계(SK0003)님은 개발 프로세스 최적화를 통해 원가 절감 목표 10% 중 8.1%를 달성하며, 효율적인 개발 프로세스를 완전히 정착시켰습니다. 특히, 김개발님과의 AI 지원 체계 구축 및 박DB님과의 모니터링 시스템 협업을 통해 팀의 기여도를 높였습니다. 이설계님은 47점의 기여도를 기록하며 팀의 성과에 중요한 역할을 했습니다. 종합적으로, 팀은 각자의 역할을 충실히 수행하며 목표를 초과 달성하는 성과를 이루었고, 이는 향후 지속적인 성장의 기반이 될 것입니다."
                        }
                    ],
                    "개인 종합 달성률": 71,
                    "종합 기여 코멘트": "이설계(SK0003)님은 Solution Architect로서 다양한 프로젝트에 참여하여 전체 평균 달성률 70.8%와 평균 기여도 45.0점을 기록하였습니다. 특히 AI 코딩 자동화 시스템 설계에서 98%의 높은 달성률을 보이며 37점의 기여도를 달성한 것은 주목할 만한 성과입니다. 그러나 프로젝트 효율성 관리와 고객 관계 관리에서 각각 70%와 50%의 달성률을 기록하며 개선이 필요한 부분이 드러났습니다. 개발 프로세스 최적화를 통한 원가 절감에서도 65%의 달성률을 보였으나, 기여도는 44점으로 상대적으로 낮은 편입니다. 이설계님은 4개의 Task에 참여하며 팀 평균 달성률 92.0%에 비해 다소 낮은 성과를 보였으나, AI 코딩 자동화 시스템 설계에서의 성과는 향후 성장 포인트로 작용할 수 있습니다. 현재 역량 평가에서 이설계님은 특정 분야에서 뛰어난 성과를 보였으나, 전반적인 프로젝트 관리 및 고객 관계 개선에 대한 추가적인 노력이 필요합니다."
                },
                "Peer_Talk": {
                    "강점": "해당 직원은 AI 코딩 자동화 아키텍처 설계의 대부분을 꼼꼼하게 완료하고, 프로토타입 구현 및 검증을 성공적으로 수행했습니다. 또한, 코드 생성 엔진과 저장소 시스템 협업에서 리더십을 발휘하며 의사결정 과정에서 감정적인 반응을 잘 관리하여 업무 스트레스를 효과적으로 극복하는 능력을 보여주었습니다.",
                    "우려": "해당 직원은 AI 코딩 자동화 아키텍처 설계와 프로토타입 구현 과정에서 감정적이고 방어적인 태도로 인해 팀원들과의 협업에 어려움을 겪었습니다. 또한, 비판적이고 권위적인 태도로 인해 팀 내에서 갑질로 비춰질 수 있는 상황을 초래할 수 있습니다. 이러한 부분에 대한 개선이 필요합니다.",
                    "협업 관찰": "해당 직원은 리더십을 발휘하여 협업을 이끌어가는 능력을 보였으나, 감정적이고 방어적인 태도로 인해 팀원들과의 원활한 협업에 어려움을 겪었습니다. 이는 팀 내에서의 의사소통과 협력에 부정적인 영향을 미칠 수 있으므로, 보다 개방적이고 수용적인 태도를 통해 팀원들과의 관계를 개선할 필요가 있습니다."
                }
            },
            {
                "기본_내용": {
                    "이름": "박DB",
                    "직무": "DB Specialist",
                    "CL레벨": "CL3"
                },
                "AI_점수_산출_기준": {
                    "업적": {
                        "점수": 2.2,
                        "실적 요약": "박DB(SK0004)님은 올해 두 가지 주요 Task에 참여하여 평균 달성률 70.5%와 평균 기여도 40.5점을 기록하였습니다. 특히 AI 시스템 데이터베이스 구축 Task에서는 81%의 달성률을 보이며 29점의 기여도를 나타냈고, 시스템 성능 최적화를 통한 운영비 절감 Task에서는 60%의 달성률과 52점의 기여도를 기록하였습니다. 이러한 성과는 팀 전체 평균 달성률 104.8%에 비해 다소 낮은 수치이나, 박DB님이 기여한 영역에서의 성과는 팀의 목표 달성에 중요한 역할을 했음을 보여줍니다. 분기별 성장 추이를 살펴보면, 박DB님은 초기 Task에서의 성과를 바탕으로 후반기에는 성과를 개선하기 위한 노력을 기울였으나, 전반적인 성과는 팀 평균에 미치지 못했습니다. 종합적으로 평가할 때, 박DB님은 특정 Task에서 두드러진 기여를 하였으나, 전반적인 성과 향상을 위해 추가적인 노력이 필요할 것으로 보입니다. 이러한 분석을 통해 향후 성과 개선을 위한 방향성을 제시할 수 있을 것입니다."
                    },
                    "SK_Values": {
                        "Passive": {
                            "점수": 4.5,
                            "평가 근거": "박DB는 다양한 프로젝트에서 주인의식을 가지고 적극적으로 업무를 추진하며, 성과를 지속적으로 초과 달성하였습니다. 특히, 여러 협업을 통해 문제를 해결하고, 성과를 도출하는 데 기여한 점이 두드러집니다. 그러나 목표 달성률이 140% 이상 150% 미만으로, 지속적인 최고 수준의 노력을 보여주었지만, 압도적인 성과에는 미치지 못했습니다."
                        },
                        "Proactive": {
                            "점수": 4.5,
                            "평가 근거": "박DB는 AI 시스템의 데이터 요구사항 분석과 성능 최적화 작업을 통해 조직의 효율성을 높이고 운영비 절감에 기여했습니다. 특히, 시스템 성능 분석과 병목 지점 식별을 통해 구체적인 개선 방안을 제시하고 실행하여 성과를 달성했습니다. 이러한 점에서 박DB는 혁신적인 아이디어를 실행하고, 팀 및 조직의 변화를 주도하는 능동적인 태도를 보였습니다."
                        },
                        "Professional": {
                            "점수": 4.5,
                            "평가 근거": "박DB는 AI 시스템의 데이터베이스 구축 및 최적화 과정에서 다양한 역할을 수행하며, 팀의 생산성을 높이는 데 기여했습니다. 특히, 성능 분석과 최적화 작업을 통해 운영비 절감과 시스템 성능 향상에 기여한 점이 두드러집니다. 또한, 동료들과의 협업을 통해 복잡한 문제를 해결하고, 기술적 지식을 효과적으로 전파한 점에서 전문성을 인정받을 수 있습니다."
                        },
                        "People": {
                            "점수": 3.5,
                            "평가 근거": "박DB는 팀 내에서 데이터베이스 구축 및 성능 최적화에 기여하며, 협업률이 100%로 매우 높지만, 협업 과정에서 회피형 태도와 무관심을 보임으로써 소통이 원활하지 않았습니다. 이러한 점에서 원활한 소통 및 상호 존중의 기준을 충족하지 못해 3.5점을 부여하였습니다."
                        }
                    },
                    "종합 원점수": 3.02,
                    "AI 추천 점수 (CL 정규화)": 3.02,
                    "평가 근거 요약": "박DB(SK0004)님은 올해 두 가지 주요 Task에 참여하여 평균 달성률 70.5%와 평균 기여도 40.5점을 기록하였습니다. 달성률 점수는 2.2점으로 C등급에 해당하며, 이는 목표 미달을 나타냅니다. 특히 AI 시스템 데이터베이스 구축 Task에서는 81%의 달성률을 보였으나, 시스템 성능 최적화 Task에서는 60%의 달성률을 기록하여 팀 전체 평균 달성률 104.8%에 비해 다소 낮은 수치입니다. 4P 평가 결과는 Passionate, Proactive, Professional 모두 4.5점으로 우수하나, People 점수는 3.5점으로 상대적으로 낮습니다. 이는 팀 내 소통과 협업에서 개선이 필요함을 시사합니다. 최종 정규화 점수는 3.02점으로, CL3 내에서 원시 점수를 유지하며 팀의 목표 달성에 기여한 바가 있으나, 전반적인 성과 향상을 위해 추가적인 노력이 필요할 것으로 보입니다."
                },
                "연간_핵심_성과_기여도": {
                    "Task_표": [
                        {
                            "Task명": "AI 시스템 데이터베이스 구축",
                            "핵심 Task": "AI 학습 데이터 DB 구조 85% 완성. 데이터 수집/저장/관리 시스템 구축. 김개발님과 연동 테스트, 이설계님과 관리 정책 협업 완료.",
                            "누적 달성률 (%)": 81,
                            "분석 코멘트": "2023년 동안 박DB(SK0004)님은 AI 학습 데이터 DB 구조 완성이라는 목표를 향해 81%의 달성률을 기록하며 팀의 평균 달성률인 104.8%에 기여하였습니다. 누적 성과로는 AI 학습 데이터 DB 구조의 85% 완성을 이루었으며, 데이터 수집, 저장, 관리 시스템을 성공적으로 구축하였습니다. 또한, 김개발님과의 연동 테스트 및 이설계님과의 관리 정책 협업을 통해 팀의 전반적인 성과에 긍정적인 영향을 미쳤습니다. 이러한 기여도는 29점으로 평가되며, 이는 팀 내에서 중요한 역할을 수행했음을 나타냅니다. 전반적으로 박DB님은 팀의 성장 추이에 기여하며, 향후에도 지속적인 발전이 기대되는 성과를 달성하였습니다."
                        },
                        {
                            "Task명": "시스템 성능 최적화를 통한 운영비 절감",
                            "핵심 Task": "인프라 운영비 9% 절감 달성(목표 대비 90%). 지속적인 성능 모니터링 및 최적화 체계 구축. 김개발님과 AI 시스템 최적화, 이설계님과 비용 효율성 협업 완료.",
                            "누적 달성률 (%)": 60,
                            "분석 코멘트": "2023년 동안 박DB(SK0004)님은 시스템 성능 최적화를 통해 인프라 운영비를 9% 절감하는 성과를 달성하였으며, 이는 설정된 목표인 15% 대비 90%에 해당합니다. 팀 평균 달성률이 104.8%인 가운데, 박DB님은 지속적인 성능 모니터링 및 최적화 체계를 구축하여 팀의 성장에 기여하였습니다. 특히, 김개발님과의 AI 시스템 최적화 및 이설계님과의 비용 효율성 협업을 통해 팀의 목표 달성에 중요한 역할을 하였습니다. 이러한 기여도는 52점으로 평가되며, 이는 팀 내에서의 박DB님 개인의 성과와 팀 전체의 성장 추이를 반영합니다. 종합적으로, 박DB님은 연간 성과에서 긍정적인 영향을 미쳤으며, 팀의 목표 달성에 기여한 바가 큽니다."
                        }
                    ],
                    "개인 종합 달성률": 68,
                    "종합 기여 코멘트": "박DB(SK0004)님은 DB Specialist로서 두 가지 주요 Task에 참여하여 평균 달성률 64.0%와 평균 기여도 42.0점을 기록하였습니다. AI 시스템 데이터베이스 구축 Task에서는 75%의 달성률을 보이며 29점의 기여도를 나타냈고, 시스템 성능 최적화를 통한 운영비 절감 Task에서는 53%의 달성률과 55점의 기여도를 기록했습니다. 이러한 성과는 팀 평균 달성률 92.0%에 비해 다소 낮은 수치이나, 박DB님은 두 Task에서 각각의 목표를 향해 지속적으로 노력하고 있음을 보여줍니다. 현재 역량 평가에 따르면, 박DB님은 데이터베이스 구축에 대한 높은 이해도를 바탕으로 성과를 내고 있으나, 시스템 최적화 부분에서의 개선이 필요합니다. 향후 성장을 위해서는 최적화 Task에서의 성과를 높이는 것이 중요한 성장 포인트로 판단됩니다."
                },
                "Peer_Talk": {
                    "강점": "해당 직원은 AI 학습 데이터 DB 구조의 75%를 성실하게 완성하고, 성능 최적화 및 인덱스 설계를 성공적으로 마무리했습니다. 문제해결력을 발휘하여 신뢰할 수 있는 결과를 도출하였으며, 열린 소통을 통해 기술적 성장을 이루었습니다.",
                    "우려": "해당 직원은 협업 과정에서 회피형 태도와 무관심을 보임으로써 소통이 단절되고 수동적인 모습을 보여 업무 진행에 어려움을 초래했습니다. 이러한 부분은 개선이 필요합니다.",
                    "협업 관찰": "해당 직원은 김개발님과의 데이터 적재 및 이설계님과의 성능 튜닝 협업을 통해 문제해결력을 발휘했으나, 일부 협업 과정에서 회피형 태도와 무관심으로 인해 소통이 원활하지 않았습니다."
                }
            }
        ]
    }

    sample_final_feedback = {
        "기본_정보": {
            "팀명": "W1팀",
            "팀장명": "팀장A",
            "업무_수행_기간": "2024년 연말",
            "평가_구분": "연간 최종 평가 (Period 4)"
        },
        "팀_종합_평가": {
            "평균_달성률": 132,
            "유사팀_평균": 64.5,
            "비교_분석": "우수",
            "팀_성과_분석_코멘트": "2023년 팀의 연간 성과는 전반적으로 우수한 결과를 나타내며, 팀 평균 달성률은 104.8%로 평가되었습니다. 특히, AI powered ITS 혁신 부문에서 175%의 성과를 기록하며 팀의 핵심 기여도를 높였습니다. Bilable Rate(가동률) 또한 102%로 안정적인 운영을 보여주었으며, 매출 부문에서는 150%의 성과를 달성하여 팀의 재무적 기여를 강화했습니다. 반면, 매출이익은 90%로 다소 아쉬운 수치를 보였으나, 전체적인 팀 성과는 132.9%에 달해 높은 수준의 조직력을 입증했습니다. 이러한 성과는 팀원 각자의 전문성과 협업을 통해 이루어진 결과로, 4명의 팀원이 각자의 역할을 충실히 수행한 것이 큰 기여를 했습니다. 팀의 종합적인 평가를 통해, 향후에도 지속적인 성과 향상을 기대할 수 있는 기반이 마련되었음을 확인할 수 있습니다."
        },
        "팀_업무_목표_및_달성률": {
            "업무목표표": [
                {
                    "팀_업무_목표": "AI powered ITS 혁신",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석한 결과, 김개발과 이설계는 각각 100%의 목표 달성을 이루었으며, 박DB는 85%의 목표 달성을 기록했습니다. 전체적으로 팀 KPI의 달성률은 175%로, 목표를 초과 달성한 것으로 평가됩니다. 특히, AI 제안서 자동 생성 기능과 코딩 자동화 시스템 설계가 완벽하게 완료되어 팀의 혁신적인 성과를 이끌어냈습니다. 박DB의 데이터베이스 구축은 다소 미진하지만, 전체적인 성과에 긍정적인 영향을 미쳤습니다.",
                    "달성률": 175,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "Bilable Rate (가동률)",
                    "kpi_분석_코멘트": "팀원 평균 가동률이 86%로 목표인 85%를 초과 달성하였으며, 이설계님은 프로젝트 지연 리스크를 17% 감소시켜 목표에 근접한 성과를 보였습니다. 전체적으로 팀 KPI는 긍정적인 방향으로 진행되고 있으며, 지속적인 모니터링과 협업이 효과를 보고 있습니다.",
                    "달성률": 102,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "매출",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석했을 때, 김개발님은 목표의 90%를 달성하였고, 이설계님은 목표를 초과 달성하여 82%의 성과를 보였습니다. 전체적으로 팀 KPI 목표인 인당 매출 6억에 대한 달성률은 150%로 평가됩니다. 이는 팀원들이 협력하여 성과를 극대화한 결과로, 향후에도 이러한 협업을 지속하는 것이 중요합니다.",
                    "달성률": 150,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                },
                {
                    "팀_업무_목표": "매출이익",
                    "kpi_분석_코멘트": "팀원들의 성과를 종합적으로 분석한 결과, 이설계님은 목표 대비 81% 달성, 박DB님은 목표 대비 60% 달성하여 전체적으로 KPI 목표의 90%를 달성하였습니다. 팀원들이 각자의 역할에서 원가 절감 및 수익성 개선을 위해 노력한 점은 긍정적이나, 목표 달성률이 100%에 미치지 못한 만큼 추가적인 개선이 필요합니다.",
                    "달성률": 90,
                    "달성률_평균_전사유사팀": "",
                    "비교_분석": "-"
                }
            ],
            "전사_유사팀_비교분석_코멘트": "팀의 종합 달성률은 132%로, 유사팀 평균인 64.5%를 크게 초과하여 뛰어난 성과를 보여주고 있습니다. 특히, AI powered ITS 혁신과 가동률에서 높은 성과를 기록하였으나, 매출 및 매출이익은 각각 30%로 상대적으로 낮은 수치를 보이고 있습니다. 전반적으로 팀은 혁신적인 접근과 높은 가동률을 통해 성과를 극대화하고 있으나, 매출 성장에 대한 전략이 필요합니다. 향후 매출 및 이익 증대를 위한 구체적인 계획 수립이 필요할 것으로 보입니다."
        },
        "팀_성과_요약": {
            "팀원별_성과_표": [
                {
                    "순위": 1,
                    "이름": "김개발",
                    "업적": 3.2,
                    "SK_Values_4P": {
                        "Passionate": 4.5,
                        "Proactive": 4.5,
                        "Professional": 4.5,
                        "People": 4.5
                    },
                    "최종_점수": 3.22,
                    "기여도": 41,
                    "성과_요약": "김개발(SK0002)님은 올해 총 3개의 주요 Task에 참여하여 평균 달성률 95.0%를 기록하며 팀의 성과에 기여하였습니다. 특히, AI 제안서 기능 고도화 개발과 팀 가동률 모니터링 및 개선 Task에서 각각 100%의 달성률을 보이며, 기여도는 35점과 83점으로 팀 내에서 중요한 역할을 수행하였습니다. 신규 고객 발굴 및 영업 지원 Task에서는 85%의 달성률을 기록하였으나, 기여도는 10점으로 상대적으로 낮은 편이었습니다. 이러한 성과를 바탕으로 팀 평균 달성률 104.8%를 초과 달성하는 데 기여하였으며, 김개발님은 팀의 핵심 기여 영역에서 두드러진 성과를 보였습니다. 종합역량평가에서 김개발님은 팀의 목표 달성에 있어 중요한 역할을 하였으며, 향후에도 지속적인 성과 향상을 기대할 수 있는 기반을 마련하였습니다."
                },
                {
                    "순위": 2,
                    "이름": "이설계",
                    "업적": 3.2,
                    "SK_Values_4P": {
                        "Passionate": 4.5,
                        "Proactive": 4.5,
                        "Professional": 4.5,
                        "People": 3.5
                    },
                    "최종_점수": 2.81,
                    "기여도": 38,
                    "성과_요약": "이설계(SK0003)님은 2023년 동안 총 4개의 주요 Task에 참여하여 평균 달성률 94.2%와 평균 기여도 46.8점을 기록하였습니다. 특히 AI 코딩 자동화 시스템 설계에서 120%의 높은 달성률을 보이며 35점의 기여도를 기록, 팀의 핵심 기여 영역으로 자리매김하였습니다. 반면, 프로젝트 효율성 관리와 개발 프로세스 최적화를 통한 원가 절감에서는 각각 85%와 82%의 달성률을 기록하며 기여도가 다소 낮은 편이었으나, 고객 관계 관리 및 만족도 향상에서는 90%의 달성률과 89점의 기여도로 긍정적인 성과를 나타냈습니다. 이러한 성과는 팀 평균 달성률 104.8%에 기여하며, 이설계님은 팀 내에서 중요한 역할을 수행하고 있음을 보여줍니다. 종합적으로 볼 때, 이설계님은 다양한 Task에서 고른 성과를 내며 팀의 목표 달성에 기여하고 있으며, 향후에도 지속적인 성장을 기대할 수 있는 역량을 갖추고 있습니다."
                },
                {
                    "순위": 3,
                    "이름": "박DB",
                    "업적": 2.2,
                    "SK_Values_4P": {
                        "Passionate": 4.5,
                        "Proactive": 4.5,
                        "Professional": 4.5,
                        "People": 3.5
                    },
                    "최종_점수": 0.72,
                    "기여도": 20,
                    "성과_요약": "박DB(SK0004)님은 올해 두 가지 주요 Task에 참여하여 평균 달성률 70.5%와 평균 기여도 40.5점을 기록하였습니다. 특히 AI 시스템 데이터베이스 구축 Task에서는 81%의 달성률을 보이며 29점의 기여도를 나타냈고, 시스템 성능 최적화를 통한 운영비 절감 Task에서는 60%의 달성률과 52점의 기여도를 기록하였습니다. 이러한 성과는 팀 전체 평균 달성률 104.8%에 비해 다소 낮은 수치이나, 박DB님이 기여한 영역에서의 성과는 팀의 목표 달성에 중요한 역할을 했음을 보여줍니다. 분기별 성장 추이를 살펴보면, 박DB님은 초기 Task에서의 성과를 바탕으로 후반기에는 성과를 개선하기 위한 노력을 기울였으나, 전반적인 성과는 팀 평균에 미치지 못했습니다. 종합적으로 평가할 때, 박DB님은 특정 Task에서 두드러진 기여를 하였으나, 전반적인 성과 향상을 위해 추가적인 노력이 필요할 것으로 보입니다. 이러한 분석을 통해 향후 성과 개선을 위한 방향성을 제시할 수 있을 것입니다."
                }
            ],
            "평가_기준_해석_및_유의사항": "업적 점수는 팀 목표 대비 개인 기여도를 반영하며, SK Values (4P)는 Passionate(열정), Proactive(주도성), Professional(전문성), People(협업성)을 평가합니다. 최종 점수는 업적과 4P 점수에 CL 정규화가 적용된 값이며, 기여도는 팀 목표 달성을 위한 상대적인 기여 정도를 기준으로 합니다. 순위는 최종 점수 기준으로 정렬됩니다."
        },
        "팀_조직력_및_리스크_요인": {
            "주요_리스크_목록": [
                {
                    "주요리스크": "과의존 리스크",
                    "리스크_심각도": "high",
                    "리스크_설명": "팀원들이 특정 동료에게 과도하게 의존하고 있어, 팀의 지속 가능성과 다양성이 저해될 수 있습니다. 김개발(SK0002), 이설계(SK0003), 박DB(SK0004) 모두 서로에게 높은 의존도를 보이고 있습니다.",
                    "발생_원인": [
                        "김개발, 이설계, 박DB가 서로의 주요 협업자로 지정되어 있어 협업이 지나치게 집중되고 있음.",
                        "팀원 간의 협업 편중도가 높아 다양한 팀원과의 협업이 부족함."
                    ],
                    "영향_예측": [
                        {
                            "영향 설명": "지속적인 의존은 팀의 협업 효율성을 떨어뜨리고, 팀원 간의 관계가 단절될 수 있습니다."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        "팀원 간의 협업을 다양화하기 위해 정기적인 팀 빌딩 활동을 실시하고, 각 팀원이 다른 팀원과의 협업 기회를 늘리도록 유도합니다."
                    ]
                },
                {
                    "주요리스크": "저성과자에 의한 팀 사기 저하",
                    "리스크_심각도": "high",
                    "리스크_설명": "박DB(SK0004)님의 성과가 팀 평균에 비해 현저히 낮아 팀의 전반적인 사기와 분위기에 부정적인 영향을 미칠 수 있습니다.",
                    "발생_원인": [
                        "박DB님의 평균 달성률이 70.5%로 팀 평균 104.8%에 비해 크게 부족함.",
                        "박DB님의 기여도가 20%로 낮아 팀원들이 느끼는 부담감이 증가할 수 있음."
                    ],
                    "영향_예측": [
                        {
                            "영향 설명": "팀의 사기 저하로 인해 협업의 질이 떨어지고, 팀원 간의 신뢰가 약화될 수 있습니다."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        "박DB님에게 맞춤형 멘토링과 코칭을 제공하여 성과 향상을 도모하고, 팀 내에서의 기여도를 높이기 위한 목표 설정을 지원합니다."
                    ]
                },
                {
                    "주요리스크": "매출이익 감소 리스크",
                    "리스크_심각도": "high",
                    "리스크_설명": "매출이익 KPI의 달성률이 90%로 목표에 미치지 못하고 있으며, 이는 팀의 수익성에 부정적인 영향을 미칠 수 있습니다.",
                    "발생_원인": [
                        "이설계와 박DB의 성과가 목표 대비 각각 81%와 60%로 낮음.",
                        "이들이 담당하는 프로젝트의 수익성 개선이 필요함."
                    ],
                    "영향_예측": [
                        {
                            "영향 설명": "수익성 저하는 조직의 재무 상태에 부정적인 영향을 미치고, 장기적으로는 인력 감축이나 프로젝트 축소로 이어질 수 있습니다."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        "이설계와 박DB에게 성과 개선을 위한 구체적인 목표를 설정하고, 성과 향상을 위한 교육 및 지원을 제공합니다."
                    ]
                },
                {
                    "주요리스크": "기여도 불균형 리스크",
                    "리스크_심각도": "medium",
                    "리스크_설명": "팀의 평균 기여도가 43.3점으로 다소 낮아, 팀원 간의 기여도 불균형이 우려됩니다.",
                    "발생_원인": [
                        "김개발(SK0002)과 이설계(SK0003)의 기여도가 상대적으로 높지만, 박DB(SK0004)의 기여도가 낮음.",
                        "팀 내 기여도 차이가 팀의 전반적인 성과에 부정적인 영향을 미칠 수 있음."
                    ],
                    "영향_예측": [
                        {
                            "영향 설명": "기여도 불균형은 팀의 협업과 성과에 부정적인 영향을 미치고, 팀원 간의 갈등을 유발할 수 있습니다."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        "팀원 간의 기여도를 정기적으로 평가하고, 기여도가 낮은 팀원에게는 추가적인 지원과 교육을 제공하여 기여도를 높이도록 합니다."
                    ]
                },
                {
                    "주요리스크": "고성과자의 번아웃 위험",
                    "리스크_심각도": "medium",
                    "리스크_설명": "김개발(SK0002)님은 팀의 핵심 기여자로서 높은 성과를 내고 있으나, 지속적인 높은 기대치로 인해 번아웃의 위험이 존재합니다.",
                    "발생_원인": [
                        "김개발님은 3개의 주요 Task에서 평균 달성률 95.0%를 기록하며 팀의 성과에 크게 기여하고 있음.",
                        "지속적인 높은 성과는 개인의 스트레스와 부담을 증가시킬 수 있음."
                    ],
                    "영향_예측": [
                        {
                            "영향 설명": "번아웃은 김개발님의 성과 저하로 이어질 수 있으며, 이는 팀 전체에 부정적인 영향을 미칠 수 있습니다."
                        }
                    ],
                    "운영_개선_전략_제안": [
                        "김개발님에게 업무 부담을 줄이기 위해 업무 분담을 조정하고, 정기적인 휴식과 재충전 시간을 제공하여 번아웃을 예방합니다."
                    ]
                }
            ]
        },
        "다음_연도_운영_제안": {
            "핵심_인력_운용_전략": [
                {
                    "대상": "박DB(SK0004)",
                    "실행_방안": "맞춤형 멘토링 및 코칭 제공, 성과 향상을 위한 구체적인 목표 설정"
                },
                {
                    "대상": "김개발(SK0002)",
                    "실행_방안": "업무 부담 경감을 위한 역할 분담 조정 및 정기적인 재충전 시간 제공"
                },
                {
                    "대상": "이설계(SK0003)",
                    "실행_방안": "독립적인 문제 해결 능력 강화를 위한 교육 및 프로젝트 참여 기회 제공"
                }
            ],
            "협업_구조_개선_방향": [
                {
                    "현재_문제점": "팀원 간의 과의존 리스크",
                    "개선_방안": "정기적인 팀 빌딩 활동 실시 및 다양한 팀원과의 협업 기회 확대",
                    "기대효과": "팀원 간의 협업 다양성 증대 및 의존도 감소",
                    "목표_지표": "팀원 간의 협업 편중도 20% 감소"
                },
                {
                    "현재_문제점": "저성과자에 의한 팀 사기 저하",
                    "개선_방안": "박DB님에게 맞춤형 멘토링과 성과 향상을 위한 목표 설정 지원",
                    "기대효과": "박DB님의 성과 향상으로 팀 사기 및 분위기 개선",
                    "목표_지표": "박DB님의 평균 달성률 80% 이상 달성"
                },
                {
                    "현재_문제점": "기여도 불균형 리스크",
                    "개선_방안": "정기적인 기여도 평가 및 기여도가 낮은 팀원에게 추가 지원 제공",
                    "기대효과": "팀 전체 기여도 향상 및 협업의 질 개선",
                    "목표_지표": "팀 평균 기여도 50점 이상 달성"
                }
            ]
        },
        "총평": {
            "종합_의견": "**[팀 성과 방향]**  \nW1팀은 연간 평균 달성률 132%를 기록하며 우수한 성과를 달성했습니다. 특히, 'AI powered ITS 혁신' KPI에서 175%의 진행률을 보이며 팀의 혁신 역량을 입증했습니다. 그러나 전년 대비 성장률이 없다는 점은 향후 지속적인 성장을 위해 해결해야 할 과제로 남아 있습니다. 이러한 성과는 팀의 전략적 방향성과 성과 창출 능력을 강화하는 데 기여하고 있습니다.\n\n**[구조적 인식]**  \nW1팀의 조직적 강점은 높은 평균 달성률과 중간평가 평균 3.5점으로 나타나는 팀원 간의 협력과 성과 지향적인 문화입니다. 그러나 '저성과자에 의한 팀 사기 저하'와 '기여도 불균형 리스크'는 팀의 사기와 효율성을 저해할 수 있는 구조적 도전과제로, 이를 해결하지 않으면 지속 가능한 성장에 부정적인 영향을 미칠 수 있습니다. 따라서 팀의 성과를 극대화하기 위해서는 이러한 리스크를 관리하는 것이 필수적입니다.\n\n**[향후 운영 전략]**  \n차년도 계획은 아직 구체화되지 않았으나, W1팀은 '매출이익 감소 리스크'를 해결하기 위해 매출이익 KPI의 진행률을 90%에서 최소 120%로 끌어올리는 것을 목표로 설정해야 합니다. 이를 위해 팀원 간의 역할 분담을 명확히 하고, 저성과자에 대한 맞춤형 지원 프로그램을 도입하여 팀 전체의 사기를 높이는 전략을 추진할 필요가 있습니다. 또한, 고성과자의 번아웃 위험을 방지하기 위해 업무 분담의 균형을 맞추고, 정기적인 피드백 세션을 통해 팀원들의 의견을 수렴하는 것이 중요합니다."
        }
    }

    # LLM 클라이언트 초기화
    print("🔗 OpenAI LLM 클라이언트 초기화 중...")
    llm_client = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    
    # Agent 생성
    agent = TeamLeaderToneAdjustmentAgent(llm_client)
    
    # 테스트 실행
    # result = agent.process_report(sample_team_feedback, "team_feedback_reports")
    result = agent.process_report(sample_mid_feedback, "team_interim_evaluation")
    # result = agent.process_report(sample_final_feedback, "team_final_reports")
    
    print("\n📋 이전 결과:")
    # print(json.dumps(sample_team_feedback, ensure_ascii=False, indent=2))
    # print(sample_team_feedback)
    print(sample_mid_feedback)
    # print(sample_final_feedback)


    print("\n📋 처리 결과:")
    print(result)

if __name__ == "__main__":
    import argparse
    
    parser = argparse.ArgumentParser(description="팀별 톤 조정 실행")
    parser.add_argument('--period-id', type=int, required=True, help='분기 ID')
    parser.add_argument('--teams', nargs='+', type=int, required=True, help='팀 ID 목록')
    
    args = parser.parse_args()
    
    # 메인 함수 실행
    result = main(args.period_id, args.teams)
    print(f"팀별 톤 조정 결과: {result}")
else:
    test_team_leader_tone_agent()